name: V3.2(A) Duffel Feeder
on:
  workflow_dispatch:
  schedule:
    # UK time (Dec = UTC). Runs before your 07:30 / 16:30 publish windows.
    - cron: "55 6 * * *"
    - cron: "55 15 * * *"

concurrency:
  group: v32a-feeder
  cancel-in-progress: false

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 8
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - env:
          SHEET_ID: ${{ secrets.SHEET_ID }}
          RAW_DEALS_TAB: ${{ secrets.RAW_DEALS_TAB }}
          GCP_SA_JSON: ${{ secrets.GCP_SA_JSON }}
          DUFFEL_API_KEY: ${{ secrets.DUFFEL_API_KEY }}

          # Optional overrides:
          FEEDER_CONFIG_TAB: ${{ vars.FEEDER_CONFIG_TAB }}
          FEEDER_LOG_TAB: ${{ vars.FEEDER_LOG_TAB }}
          FEEDER_MAX_SEARCHES: ${{ vars.FEEDER_MAX_SEARCHES }}
          FEEDER_MAX_INSERTS: ${{ vars.FEEDER_MAX_INSERTS }}
          FEEDER_SLEEP_SECONDS: ${{ vars.FEEDER_SLEEP_SECONDS }}

          WORKER_ID: duffel_feeder
        run: python workers/duffel_feeder.py


